<html>
<head>
<link rel="stylesheet" href="/house.css">
<link rel="stylesheet" href="/note/layout.css">
<script language="javascript" type="text/javascript">

var NoteCurrentPath = '/';
var NoteCurrentDocument = null;

function noteButton (css) {
   var button = document.createElement("button");
   if (css) button.className = css;
   else button.className = 'housenotebutton';
   return button;
}

function noteWipeout (id) {
   var element = document.getElementById (id);
   if (element) {
      for (var i = element.rows.length - 1; i >= 0; --i) {
         element.deleteRow(i);
      }
   }
   return element;
}

function noteContentShow (uri, text) {
   var iframe = document.getElementById ('notecontent');
   if (uri) iframe.src = uri;
   else iframe.src = null;
   iframe.width = '100%';
   iframe.height = '100%';
   iframe.className = 'housenotecontent';
   var title = document.getElementById ('titlecontent');
   title.innerHTML = text?text:'';
}

function notePathShow () {
   var steps = NoteCurrentPath.substring (1).split ('/');
   var table = noteWipeout ('notepath');
   var row = table.insertRow ();
   var column = document.createElement('td');
   column.className = "housenotetop"; // Kludge to override browser's defaults
   var button = noteButton ('housenotebuttontop');
   button.innerHTML = '/';
   button.houseNotePath = '/';
   button.addEventListener ("click", noteBrowseClick);
   column.appendChild (button);
   var first = 1;
   for (i = 0; i < steps.length; ++i) {
      if (steps[i].length == 0) continue;
      if (!first) column.appendChild (document.createTextNode (' / '));
      first = false;
      button = noteButton ('housenotebuttontop');
      button.innerHTML = steps[i];
      button.houseNotePath = '/'+steps.slice(0,i+1).join('/');
      button.addEventListener ("click", noteBrowseClick);
      column.appendChild (button);
   }
   row.appendChild (column);

   var column = document.createElement('td');
   column.id = 'titlecontent';
   column.style = 'text-align: right;';
   column.className = "housenotetop"; // Kludge to override browser's defaults
   row.appendChild (column);
}

function noteBrowseClick () {
   noteContentShow ();
   noteBrowseGet (this.houseNotePath);
}

function noteContentClick () {
   noteContentShow (this.houseNotePath, this.innerHTML);
}

function compareDisplayName (a, b) {
   var namea = a[2].toUpperCase();
   var nameb = b[2].toUpperCase();
   if (namea < nameb) return -1;
   if (namea > nameb) return 1;
   return 0;
}

function noteNavigatorShow (response) {
   notePathShow ();
   var table = noteWipeout ('notelist');
   var itemlist = response.note.browse.sort (compareDisplayName);

   for (i = 0; i < itemlist.length; ++i) {
      var item = itemlist[i];
      if (!item[0]) continue; // See 2nd loop.
      var line = table.insertRow ();
      var column = document.createElement("td");
      var button = noteButton ();
      button.addEventListener ("click", noteBrowseClick);
      button.houseNotePath = item[1];
      button.innerHTML = item[2] + '  &#x25b8';
      column.appendChild (button);
      line.appendChild (column);
   }

   for (i = 0; i < itemlist.length; ++i) {
      var item = itemlist[i];
      if (item[0]) continue; // See 1st loop.
      var line = table.insertRow ();
      var column = document.createElement("td");
      var button = noteButton ();
      button.addEventListener ("click", noteContentClick);
      button.houseNotePath = item[1];
      button.innerHTML = item[2];
      column.appendChild (button);
      line.appendChild (column);
   }
}

function noteBrowseGet (path) {
   var command = new XMLHttpRequest();
   command.open("GET", "/note/browse"+path);
   command.onreadystatechange = function () {
      if (command.readyState === 4 && command.status === 200) {
         NoteCurrentPath = path;
         noteNavigatorShow(JSON.parse(command.responseText));
      }
   }
   command.send(null);
}

window.onload = function() {
    noteBrowseGet ('/');
};
</script>
<title>Notes</title>
</head>
<body class="housenotepage">
   <header class="housenotetop">
      <table id="notepath" width="100%"></table>
   </header>
   <div>
      <div class="housenotelist">
         <table cellpadding="0" border="0" id="notelist" width="100%">
         </table>
      </div>
      <div class="housenotecontainer">
         <iframe id="notecontent" class="housenotecontent"></iframe>
      </div>
   </div>
   <footer></footer>
</body>
</html>

